<!DOCTYPE html>
<html>
<head>
<script src="Tools2D.js"></script>
<script>

Tools2D.Point.prototype.draw = function(ctx, label)
{
   ctx.beginPath();
   ctx.arc(this.x, this.y, 5, 0, 2 * Math.PI);
   ctx.stroke();
   if (label)
   {
      ctx.fillText(label, this.x + 10, this.y);
   }
}

Tools2D.Line.prototype.draw = function(ctx)
{
   this.startPoint.draw(ctx);
   this.endPoint.draw(ctx);
   ctx.beginPath();
   ctx.moveTo(this.startPoint.x, this.startPoint.y);
   ctx.lineTo(this.endPoint.x, this.endPoint.y);
   ctx.stroke();
}

Tools2D.Circle.prototype.draw = function(ctx)
{
   this.center.draw(ctx);
   ctx.beginPath();
   ctx.arc(this.center.x, this.center.y, this.radius, 0, 2 * Math.PI);
   ctx.stroke();
}

var behaviour = {};

// ----------------------------------------------------------------------------

var DistancePointCircle =
{
   state : "CenterPoint",
   circle : new Tools2D.Circle(new Tools2D.Point(0, 0), 0),
   point : new Tools2D.Point(0, 0)
};

DistancePointCircle.draw = function(ctx)
{
   switch (this.state)
   {
      case "CenterPoint":
      {
         break;
      }
      case "Radius":
      {
        this.circle.draw(ctx);
	break;
      }
      case "FirstPoint":
      {
        this.circle.draw(ctx);
	break;
      }
      case "OtherPoint":
      {
        this.circle.draw(ctx);
	var distance = Math.round(Tools2D.distancePointToCircle(this.point, this.circle));
	this.point.draw(ctx, distance);
	break;
      }
   }
};

DistancePointCircle.mouseUp = function(event)
{
   switch (this.state)
   {
      case "CenterPoint":
      {
         this.circle.center.x = event.offsetX;
	 this.circle.center.y = event.offsetY;
         this.circle.radius = 0;
	 this.state = "Radius";
	 break;
      }
      case "Radius":
      {
         this.circle.radius = Tools2D.distancePointToPoint(this.circle.center, new Tools2D.Point(event.offsetX, event.offsetY));
	 this.state = "FirstPoint";
	 break;
      }
      case "FirstPoint":
      {
         this.point.x = event.offsetX;
	 this.point.y = event.offsetY;
	 this.state = "OtherPoint";
	 break;
      }      
      case "OtherPoint":
      {
         this.point.x = event.offsetX;
	 this.point.y = event.offsetY;
	 this.state = "OtherPoint";
	 break;
      }      
   }
};

DistancePointCircle.mouseMove = function(event)
{
   switch (this.state)
   {
      case "Radius":
      {
         this.circle.radius = Tools2D.distancePointToPoint(this.circle.center, new Tools2D.Point(event.offsetX, event.offsetY));
	 break;
      }
      
   }
};

DistancePointCircle.keyUp = function (event)
{
   if (event.key == "Backspace")
   {
      switch (this.state)
      {
         case "Radius":
	 {
	    this.state = "CenterPoint";
	    break;
	 }
	 case "FirstPoint":
	 case "OtherPoint":
	 {
	    this.state = "Radius";
	    break;
	 }
      }
   }
}

DistancePointCircle.help = function (event)
{
   switch (this.state)
   {
      case "CenterPoint":
      {
         return "Set center point of circle";
      }
      case "Radius":
      {
         return "Set radius of circle";
      }
      case "FirstPoint":
      case "OtherPoint":
      {
         return "Set point";
      }      
   }
}

// ----------------------------------------------------------------------------

var DistancePointLineSegment = 
{
   state : "StartPoint",
   line : new Tools2D.Line( new Tools2D.Point(0, 0), new Tools2D.Point(0, 0)),
   point : new Tools2D.Point(0, 0)
};

DistancePointLineSegment.draw = function(ctx)
{
   switch (this.state)
   {
      case "StartPoint":
      {
         break;
      }
      case "EndPoint":
      {
        this.line.startPoint.draw(ctx);
        ctx.beginPath();
	ctx.moveTo(this.line.startPoint.x, this.line.startPoint.y);
	ctx.lineTo(this.line.endPoint.x, this.line.endPoint.y);
	ctx.stroke();
	break;
      }
      case "FirstPoint":
      {
        this.line.draw(ctx);
	break;
      }
      case "OtherPoint":
      {
        this.line.draw(ctx);
	var distance = Math.round(Tools2D.distancePointToLineSegment(this.point, this.line));
	this.point.draw(ctx, distance);
	break;
      }
   }
};

DistancePointLineSegment.mouseUp = function(event)
{
   switch (this.state)
   {
      case "StartPoint":
      {
         this.line.startPoint.x = event.offsetX;
	 this.line.startPoint.y = event.offsetY;
         this.line.endPoint.x = event.offsetX;
	 this.line.endPoint.y = event.offsetY;
	 this.state = "EndPoint";
	 break;
      }
      case "EndPoint":
      {
         this.line.endPoint.x = event.offsetX;
	 this.line.endPoint.y = event.offsetY;
	 this.state = "FirstPoint";
	 break;
      }
      case "FirstPoint":
      {
         this.point.x = event.offsetX;
	 this.point.y = event.offsetY;
	 this.state = "OtherPoint";
	 break;
      }      
      case "OtherPoint":
      {
         this.point.x = event.offsetX;
	 this.point.y = event.offsetY;
	 this.state = "OtherPoint";
	 break;
      }      
   }
};

DistancePointLineSegment.mouseMove = function(event)
{
   switch (this.state)
   {
      case "EndPoint":
      {
         this.line.endPoint.x = event.offsetX;
	 this.line.endPoint.y = event.offsetY;
	 break;
      }
      
   }
};

DistancePointLineSegment.keyUp = function (event)
{
   if (event.key == "Backspace")
   {
      switch (this.state)
      {
         case "EndPoint":
	 {
            this.line.endPoint.x = this.line.startPoint.x;
            this.line.endPoint.y = this.line.startPoint.y;
	    this.state = "StartPoint";
	    break;
	 }
	 case "FirstPoint":
	 case "OtherPoint":
	 {
	    this.state = "EndPoint";
	    break;
	 }
      }
   }
}

DistancePointLineSegment.help = function (event)
{
   switch (this.state)
   {
      case "StartPoint":
      {
         return "Set start point of line";
      }
      case "EndPoint":
      {
         return "Set end point of line";
      }
      case "FirstPoint":
      case "OtherPoint":
      {
         return "Set point";
      }      
   }
}

// ----------------------------------------------------------------------------

var IntersectionLineSegmentLineSegment =
{
   state : "StartPoint1",
   line1 : new Tools2D.Line(new Tools2D.Point(0, 0), new Tools2D.Point(0, 0)),
   line2 : new Tools2D.Line(new Tools2D.Point(0, 0), new Tools2D.Point(0, 0))
};

IntersectionLineSegmentLineSegment.draw = function(ctx)
{
   switch (this.state)
   {
      case "StartPoint1":
      {
         break;
      }
      case "EndPoint1":
      {
        this.line1.startPoint.draw(ctx);
	break;
      }
      case "StartPoint2":
      {
        this.line1.draw(ctx);
	break;
      }
      case "EndPoint2":
      {
        this.line1.draw(ctx);
        this.line2.startPoint.draw(ctx);
	break;
      }
      case "ShowResult":
      {
        this.line1.draw(ctx);
	this.line2.draw(ctx);
	var intersection = Tools2D.intersectionLineSegmentLineSegment(this.line1, this.line2);
	if (intersection)
	{
           intersection.draw(ctx);
	}
	break;
      }
   }
};

IntersectionLineSegmentLineSegment.mouseUp = function(event)
{
   switch (this.state)
   {
      case "StartPoint1":
      {
         this.line1.startPoint.x = event.offsetX;
	 this.line1.startPoint.y = event.offsetY;
	 this.state = "EndPoint1";
	 break;
      }
      case "EndPoint1":
      {
         this.line1.endPoint.x = event.offsetX;
	 this.line1.endPoint.y = event.offsetY;
	 this.state = "StartPoint2";
	 break;
      }
      case "StartPoint2":
      {
         this.line2.startPoint.x = event.offsetX;
	 this.line2.startPoint.y = event.offsetY;
	 this.state = "EndPoint2";
	 break;
      }      
      case "EndPoint2":
      {
         this.line2.endPoint.x = event.offsetX;
	 this.line2.endPoint.y = event.offsetY;
	 this.state = "ShowResult";
	 break;
      }      
      case "ShowResult":
      {
         this.line2.startPoint.x = event.offsetX;
	 this.line2.startPoint.y = event.offsetY;
	 this.state = "EndPoint2";
	 break;
      }
   }
};

IntersectionLineSegmentLineSegment.mouseMove = function(event)
{
   switch (this.state)
   {
      case "EndPoint1":
      {
         this.line1.endPoint.x = event.offsetX;
	 this.line1.endPoint.y = event.offsetY;
	 break;
      }
      case "EndPoint2":
      {
         this.line2.endPoint.x = event.offsetX;
	 this.line2.endPoint.y = event.offsetY;
	 break;
      }
   }
};

IntersectionLineSegmentLineSegment.keyUp = function (event)
{
   if (event.key == "Backspace")
   {
      switch (this.state)
      {
         case "EndPoint1":
	 {
	    this.state = "StartPoint1";
	    break;
	 }
	 case "StartPoint2":
	 {
	    this.state = "EndPoint1";
	    break;
	 }
	 case "EndPoint2":
	 {
	 {
	    this.state = "StartPoint2";
	    break;
	 }
	 }
	 case "ShowResult":
	 {
	    this.state = "EndPoint2";
	    break;
	 }
      }
   }
}

IntersectionLineSegmentLineSegment.help = function (event)
{
   switch (this.state)
   {
      case "StartPoint1":
      {
         return "Set start point of line 1";
      }
      case "EndPoint1":
      {
         return "Set end point pf line 1";
      }
      case "StartPoint2":
      {
         return "Set start point of line 2";
      }
      case "EndPoint2":
      {
         return "Set end point of line 2";
      }
      case "ShowResult":
      {
         return "Show result";
      }      
   }
}

// ----------------------------------------------------------------------------

function mouseDown(event) 
{
   if (behaviour.mouseDown)
   {
      var text = behaviour.mouseDown(event);
      document.getElementById("demo").innerHTML = text;
   }
}

function mouseUp(event) 
{
   if (behaviour.mouseUp)
   {
      behaviour.mouseUp(event);
      var c = document.getElementById("myCanvas");
      var ctx = c.getContext("2d");
      ctx.clearRect(0,0, c.width, c.height);
      behaviour.draw(ctx);
      document.getElementById("demo").innerHTML = behaviour.help();
   }
}

function mouseMove(event) 
{
   if (behaviour.mouseMove)
   {
      behaviour.mouseMove(event);
      var c = document.getElementById("myCanvas");
      var ctx = c.getContext("2d");
      ctx.clearRect(0,0, c.width, c.height);
      behaviour.draw(ctx);
      document.getElementById("demo").innerHTML = behaviour.help();
  }
}

function mouseWheel(event) 
{
   if (behaviour.mouseWheel)
   {
      behaviour.mouseWheel(event);
      document.getElementById("demo").innerHTML = behaviour.help();
   }
}

function keyDown(event) 
{
   if (behaviour.keyDown)
   {
      behaviour.keyDown(event);
      document.getElementById("demo").innerHTML = behaviour.help();
   }
}

function keyUp(event) 
{
   if (behaviour.keyUp)
   {  
      behaviour.keyUp(event);
      var c = document.getElementById("myCanvas");
      var ctx = c.getContext("2d");
      ctx.clearRect(0,0, c.width, c.height);
      behaviour.draw(ctx);
      document.getElementById("demo").innerHTML = behaviour.help();
   }
}

window.addEventListener("keydown", keyDown, false);
window.addEventListener("keyup", keyUp, false);

//behaviour = DistancePointLineSegment;
//behaviour = DistancePointCircle;
behaviour = IntersectionLineSegmentLineSegment;
</script>
</head>

<body>
<p id="demo"></p>
<canvas id="myCanvas" width="560" height="360" style="border:1px solid #000000;" 
        onmousedown="mouseDown(event)" 
        onmouseup="mouseUp(event)" 
	onmousemove="mouseMove(event)"
	onwheel="mouseWheel(event)"></canvas>

</body>
</html>
